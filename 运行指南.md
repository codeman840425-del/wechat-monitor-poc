# WeChat 消息监控 PoC - 运行指南

## 一、环境准备

### 1. 确认系统要求
- **操作系统**: Windows 10 或 Windows 11
- **Python 版本**: Python 3.8 或更高版本
- **微信版本**: Windows 桌面版微信（建议 3.x 或 4.x 版本）

### 2. 检查 Python 是否已安装
打开命令提示符（CMD）或 PowerShell，输入：
```bash
python --version
```

如果显示版本号（如 `Python 3.9.7`），说明已安装。
如果提示找不到命令，请先安装 Python：[https://www.python.org/downloads/](https://www.python.org/downloads/)

**安装 Python 时注意**：勾选 "Add Python to PATH" 选项

---

## 二、安装步骤

### 步骤 1：打开命令行
按 `Win + R`，输入 `cmd`，回车打开命令提示符。

### 步骤 2：进入项目目录
```bash
cd F:\opencode\wechat-monitor-poc
```

### 步骤 3：安装依赖包
```bash
pip install -r requirements.txt
```

**预期输出**：
```
Collecting uiautomation>=2.0.15
  Downloading uiautomation-2.0.18-py3-none-any.whl (xxx kB)
Installing collected packages: uiautomation
Successfully installed uiautomation-2.0.18
```

---

## 三、运行前准备

### 1. 启动微信
- 在 Windows 桌面上打开微信
- 扫描二维码登录
- **重要**：打开一个聊天窗口（可以是好友或群聊）
- 确保能看到聊天记录（至少有几条消息）

### 2. 确认微信窗口可见
- 聊天窗口不要最小化
- 可以放在屏幕任意位置

---

## 四、运行 PoC 脚本

### 运行命令
```bash
python wechat_poc.py
```

### 预期运行流程

1. **启动信息**
```
============================================================
微信消息监控 PoC - 阶段1：技术验证
============================================================

功能说明：
  1. 自动查找所有微信窗口
  2. 选择要读取的聊天窗口
  3. 提取并显示窗口中的消息文本
...
```

2. **查找窗口**
```
正在查找微信窗口...
找到 2 个微信窗口

============================================================
找到以下微信窗口：
============================================================
  [1] 张三 (句柄: 123456)
  [2] 工作群 (句柄: 123457)
============================================================
```

3. **选择窗口**
```
请选择要读取的窗口编号 (1-2)，输入 0 退出: 1
```
输入 `1` 选择第一个窗口，然后回车。

4. **读取结果**
```
已选择窗口: 张三
正在读取消息...

============================================================
窗口 [张三] 中的消息：
============================================================
1. 你好，在吗？
2. 有个问题想请教
3. 明天下午有空吗？
============================================================
共读取到 3 条消息
============================================================
```

5. **完成**
按回车键退出程序。

---

## 五、常见问题排查

### 问题 1：未找到微信窗口
**现象**：
```
未找到微信窗口，请检查：
  1. 微信是否已启动
  2. 是否已登录微信
  3. 微信版本是否兼容
```

**解决方法**：
1. 确认微信已经启动并登录
2. 确认打开的是 Windows 桌面版微信（不是网页版）
3. 尝试重新启动微信

### 问题 2：找到窗口但读不到消息
**现象**：
```
窗口 [xxx] 中的消息：
============================================================
未读取到任何消息
可能原因：
  1. 该窗口不是聊天窗口
  2. 微信版本较新，UI 结构发生变化
  3. 聊天窗口中没有消息
```

**解决方法**：
1. 确保选择的是聊天窗口（能看到聊天记录）
2. 尝试滚动聊天窗口，让消息可见
3. 可能是微信版本太新，需要更新代码适配

### 问题 3：权限错误
**现象**：
```
PermissionError: [WinError 5] 拒绝访问
```

**解决方法**：
1. 以管理员身份运行命令提示符
2. 右键点击 CMD 或 PowerShell → "以管理员身份运行"

### 问题 4：找不到 uiautomation 模块
**现象**：
```
错误：未安装 uiautomation 库
请运行: pip install uiautomation
```

**解决方法**：
```bash
pip install uiautomation
```

---

## 六、当前限制说明

这个 PoC 版本有以下限制，将在后续阶段逐步解决：

### 1. 只能读取可见消息
- 只能读取当前显示在窗口中的消息
- 需要向上滚动才能读取历史消息

### 2. 无法区分发送者
- 只能读取消息文本
- 无法判断消息是"我发的"还是"对方发的"

### 3. 无法自动检测新消息
- 需要手动重新运行脚本
- 不会自动监控新消息

### 4. 微信版本依赖
- 依赖微信的 UI 结构
- 微信更新后可能需要调整代码

### 5. 多开微信支持有限
- 可以枚举多个窗口
- 但需要逐个选择读取

---

## 七、下一步（阶段 2）

阶段 1 验证成功后，阶段 2 将实现：
1. 持续监控，自动检测新消息
2. 关键字过滤功能
3. 数据存储到数据库
4. 支持同时监控多个窗口

---

## 八、技术支持

如果遇到问题，可以：
1. 查看终端输出的错误信息
2. 确认微信版本和系统环境
3. 检查是否按照步骤正确操作

**重要提醒**：
- 本工具仅供技术学习使用
- 使用时请遵守相关法律法规
- 仅用于监控工作微信账号
- 需事先获得相关人员同意
